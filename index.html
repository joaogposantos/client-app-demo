<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My App Prototype</title>
    <!-- Importing Bootstrap for nice "App" styling -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Import Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body class="bg-light">
    <!-- NAVIGATION BAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="#">MyApp</a>
        <div class="navbar-nav">
          <a class="nav-link active" href="index.html">Dashboard</a>
          <a class="nav-link" href="login.html">Login History</a>
          <a class="nav-link" href="settings.html">Settings</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="row">
        <!-- INPUT FORM (Simulating adding data) -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5>Add New User</h5>
            <div class="mb-2">
              <input
                type="text"
                id="inputName"
                class="form-control"
                placeholder="Name"
              />
            </div>
            <div class="mb-2">
              <input
                type="text"
                id="inputRole"
                class="form-control"
                placeholder="Role"
              />
            </div>
            <button onclick="addRow()" class="btn btn-primary w-100">
              Add to Table
            </button>
          </div>
        </div>

        <!-- THE TABLE -->
        <div class="col-md-8">
          <div class="card p-3">
            <h5>Current Users</h5>
            <table class="table table-striped" id="userTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="userTableBody">
                <!-- Data will be loaded from Supabase -->
              </tbody>
            </table>
            <p class="text-muted mt-2">2025-11-25 16:09 UTC - Claude changed this</p>
          </div>
        </div>
      </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
      // Initialize Supabase client
      const SUPABASE_URL = 'https://bjvcjnucacasmytbqpvx.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJqdmNqbnVjYWNhc215dGJxcHZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMzI1MTksImV4cCI6MjA3OTYwODUxOX0.wB6M7haaws59sv6mGFiFwiZ-qvu0CFNvhz8tASd3cMs';
      
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // Load users from Supabase and display in table
      async function loadUsers() {
        try {
          const { data: users, error } = await supabase
            .from('users')
            .select('*')
            .order('id', { ascending: true });

          if (error) {
            console.error('Error loading users:', error);
            alert('Error loading users: ' + error.message);
            return;
          }

          const tbody = document.getElementById("userTableBody");
          tbody.innerHTML = "";

          if (users && users.length > 0) {
            users.forEach(user => {
              const row = tbody.insertRow();
              
              const cell1 = row.insertCell(0);
              const cell2 = row.insertCell(1);
              const cell3 = row.insertCell(2);
              const cell4 = row.insertCell(3);
              
              cell1.innerHTML = user.name || '';
              cell2.innerHTML = user.role || '';
              
              // Apply appropriate styling based on status
              const status = user.status || 'Active';
              if (status === "Active") {
                cell3.innerHTML = '<span class="text-success">Active</span>';
              } else if (status === "Offline") {
                cell3.innerHTML = '<span class="text-secondary">Offline</span>';
              } else {
                cell3.innerHTML = '<span class="text-success">' + status + '</span>';
              }
              
              // Add delete button
              cell4.innerHTML = '<button class="btn btn-danger btn-sm" onclick="deleteUser(' + user.id + ')">Delete</button>';
            });
          }
        } catch (err) {
          console.error('Unexpected error:', err);
          alert('Unexpected error loading users');
        }
      }

      // Add new user to Supabase
      async function addRow() {
        const name = document.getElementById("inputName").value;
        const role = document.getElementById("inputRole").value;

        if (name === "" || role === "") {
          alert("Please fill in both fields!");
          return;
        }

        try {
          const { data, error } = await supabase
            .from('users')
            .insert([
              { 
                name: name, 
                role: role, 
                status: 'Active'
              }
            ])
            .select();

          if (error) {
            console.error('Error adding user:', error);
            alert('Error adding user: ' + error.message);
            return;
          }

          // Clear the inputs
          document.getElementById("inputName").value = "";
          document.getElementById("inputRole").value = "";

          // Reload the table
          await loadUsers();
          
          alert('User added successfully!');
        } catch (err) {
          console.error('Unexpected error:', err);
          alert('Unexpected error adding user');
        }
      }

      // Delete user from Supabase
      async function deleteUser(userId) {
        if (!confirm('Are you sure you want to delete this user?')) {
          return;
        }

        try {
          const { error } = await supabase
            .from('users')
            .delete()
            .eq('id', userId);

          if (error) {
            console.error('Error deleting user:', error);
            alert('Error deleting user: ' + error.message);
            return;
          }

          // Reload the table
          await loadUsers();
          
          alert('User deleted successfully!');
        } catch (err) {
          console.error('Unexpected error:', err);
          alert('Unexpected error deleting user');
        }
      }

      // Load table data when page loads
      window.onload = function() {
        loadUsers();
      };
    </script>
  </body>
</html>
